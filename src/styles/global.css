/*
 * Sophisticated Font System - Four Paradigms
 *
 * Display: Inter → Geometric precision (systems thinking)
 * Body: Crimson Pro → Humanist warmth (consciousness research)
 * Mono: JetBrains Mono → Technical clarity (code/data)
 * Accent: Cormorant Garamond → Artistic flourish (music/creativity)
 *
 * Fonts loaded via <link> in BaseLayout.astro for non-blocking render
 */

/* ===================================================================
   MODERN CSS LAYER SYSTEM (Cascade Management)
   ================================================================ */

@layer reset, base, components, utilities, overrides;

@layer reset {
  @tailwind base;
}

@layer components {
  @tailwind components;
}

@layer utilities {
  @tailwind utilities;
}

/* Base styles */
* {
  @apply transition-colors duration-200;
}

html {
  @apply scroll-smooth;
}

body {
  @apply bg-white text-gray-900 dark:bg-gray-900 dark:text-white antialiased;
  /* Body: Humanist serif for warmth and readability */
  font-family: 'Crimson Pro', Georgia, serif;
  font-size: 18px;
  line-height: 1.7;
  font-weight: 400;
  letter-spacing: 0.01em;
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 10px;
}

::-webkit-scrollbar-track {
  background: #111827;
}

::-webkit-scrollbar-thumb {
  background: #0284c7;
  border-radius: 9999px;
}

::-webkit-scrollbar-thumb:hover {
  background: #0ea5e9;
}

/* Gradient text */
.gradient-text {
  @apply bg-clip-text text-transparent bg-gradient-to-r from-primary-400 via-accent-400 to-primary-400;
  background-size: 200% auto;
  animation: shimmer 3s linear infinite;
}

/* Glass morphism */
.glass {
  @apply bg-white/5 backdrop-blur-lg border border-white/10;
}

/* Glow effect */
.glow {
  box-shadow: 0 0 20px rgba(14, 165, 233, 0.3),
              0 0 40px rgba(168, 85, 247, 0.2);
}

.glow:hover {
  box-shadow: 0 0 30px rgba(14, 165, 233, 0.5),
              0 0 60px rgba(168, 85, 247, 0.3);
}

/* Three.js container */
.three-container {
  @apply relative w-full h-full;
}

.three-container canvas {
  @apply w-full h-full block;
}

/* Link styles */
a {
  @apply no-underline;
}

a:hover {
  @apply text-primary-400;
}

/* Section spacing */
section {
  @apply py-20 md:py-32;
}

/* Container max-width */
.container {
  @apply max-w-7xl mx-auto px-4 sm:px-6 lg:px-8;
}

/* Buttons */
.btn {
  padding: 0.75rem 1.5rem;
  border-radius: 0.5rem;
  font-weight: 500;
  transition: all 0.2s;
}

.btn:hover {
  transform: scale(1.05);
}

.btn-primary {
  background: linear-gradient(to right, #0284c7, #9333ea);
  color: white;
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
}

.btn-primary:hover {
  background: linear-gradient(to right, #0ea5e9, #a855f7);
}

.btn-outline {
  border: 2px solid #0ea5e9;
  color: #38bdf8;
}

.btn-outline:hover {
  background: #0ea5e9;
  color: white;
}

/* Typography - Sophisticated Font System */

/* Display: Geometric sans for headings (systems precision) */
h1, h2, h3, h4, h5, h6 {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  @apply font-bold leading-tight;
  letter-spacing: -0.02em; /* Tighter tracking for display */
}

h1 {
  @apply text-5xl md:text-7xl;
  font-weight: 800; /* Bold for impact */
}

h2 {
  @apply text-4xl md:text-6xl;
  font-weight: 800;
}

h3 {
  @apply text-3xl md:text-5xl;
  font-weight: 700;
}

/* Accent: Artistic serif for quotes, pullouts, special emphasis */
.accent-text, blockquote {
  font-family: 'Cormorant Garamond', Georgia, serif;
  font-weight: 600;
  font-style: italic;
  letter-spacing: 0.02em;
}

/* Mono: Technical monospace for code, data, technical content */
code, pre, .mono, .technical {
  font-family: 'JetBrains Mono', 'Fira Code', Consolas, monospace;
  font-weight: 400;
  letter-spacing: -0.01em;
}

/* Font class utilities for intentional mixing */
.font-display {
  font-family: 'Inter', -apple-system, sans-serif;
  font-weight: 800;
  letter-spacing: -0.02em;
}

.font-body {
  font-family: 'Crimson Pro', Georgia, serif;
  font-weight: 400;
  letter-spacing: 0.01em;
}

.font-mono {
  font-family: 'JetBrains Mono', Consolas, monospace;
  font-weight: 500;
}

.font-accent {
  font-family: 'Cormorant Garamond', Georgia, serif;
  font-weight: 600;
  font-style: italic;
}

/* Animations */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.fade-in {
  animation: fadeIn 0.6s ease-out forwards;
}

/* Ken Burns Effect - Sophisticated slow zoom and pan animations */
@keyframes kenBurnsZoomPanA {
  0% {
    transform: scale(1) translate(0, 0);
  }
  100% {
    transform: scale(1.1) translate(-2%, -1%);
  }
}

@keyframes kenBurnsZoomPanB {
  0% {
    transform: scale(1) translate(0, 0);
  }
  100% {
    transform: scale(1.08) translate(1%, -2%);
  }
}

@keyframes kenBurnsZoomPanC {
  0% {
    transform: scale(1) translate(0, 0);
  }
  100% {
    transform: scale(1.12) translate(-1%, 1%);
  }
}

@keyframes kenBurnsZoomPanD {
  0% {
    transform: scale(1) translate(0, 0);
  }
  100% {
    transform: scale(1.09) translate(2%, 0);
  }
}

@keyframes kenBurnsZoomPanE {
  0% {
    transform: scale(1) translate(0, 0);
  }
  100% {
    transform: scale(1.11) translate(0, -2%);
  }
}

@keyframes kenBurnsZoomPanF {
  0% {
    transform: scale(1) translate(0, 0);
  }
  100% {
    transform: scale(1.1) translate(-1%, 2%);
  }
}

/* Ken Burns utility classes for different pages */
.ken-burns-a {
  animation: kenBurnsZoomPanA 25s ease-out infinite alternate;
  will-change: transform;
}

.ken-burns-b {
  animation: kenBurnsZoomPanB 28s ease-out infinite alternate;
  will-change: transform;
}

.ken-burns-c {
  animation: kenBurnsZoomPanC 30s ease-out infinite alternate;
  will-change: transform;
}

.ken-burns-d {
  animation: kenBurnsZoomPanD 26s ease-out infinite alternate;
  will-change: transform;
}

.ken-burns-e {
  animation: kenBurnsZoomPanE 32s ease-out infinite alternate;
  will-change: transform;
}

.ken-burns-f {
  animation: kenBurnsZoomPanF 29s ease-out infinite alternate;
  will-change: transform;
}

/* Stagger animation delays */
.stagger-1 { animation-delay: 0.1s; }
.stagger-2 { animation-delay: 0.2s; }
.stagger-3 { animation-delay: 0.3s; }
.stagger-4 { animation-delay: 0.4s; }

/* ===================================================================
   ADVANCED PARALLAX SCROLL SYSTEM
   ================================================================ */

/* Parallax Speed Utility Classes */
.parallax-slow {
  will-change: transform;
}

.parallax-medium {
  will-change: transform;
}

.parallax-fast {
  will-change: transform;
}

/* Fade-in on Scroll */
.fade-in-on-scroll {
  opacity: 0;
  will-change: opacity, transform;
}

/* Stagger delays for fade-in elements */
.stagger-delay-1 { transition-delay: 100ms; }
.stagger-delay-2 { transition-delay: 200ms; }
.stagger-delay-3 { transition-delay: 300ms; }
.stagger-delay-4 { transition-delay: 400ms; }
.stagger-delay-5 { transition-delay: 500ms; }
.stagger-delay-6 { transition-delay: 600ms; }

/* Parallax Container - for sections with parallax backgrounds */
.parallax-container {
  position: relative;
  overflow: hidden;
  isolation: isolate;
}

/* Parallax Background Layer */
.parallax-bg {
  position: absolute;
  inset: -10% 0; /* Extra height for parallax movement */
  z-index: 0;
  will-change: transform;
}

/* Parallax Content Layer */
.parallax-content {
  position: relative;
  z-index: 1;
}

/* Card Parallax Effect - subtle 3D shift */
.card-parallax {
  transition: transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
  will-change: transform;
}

.card-parallax:hover {
  transform: translateY(-4px);
}

/* Disable parallax on mobile or reduced motion */
@media (max-width: 768px), (prefers-reduced-motion: reduce) {
  .parallax-slow,
  .parallax-medium,
  .parallax-fast,
  .parallax-bg {
    transform: none !important;
    will-change: auto;
  }

  .fade-in-on-scroll {
    opacity: 1 !important;
    transform: none !important;
  }

  .card-parallax:hover {
    transform: translateY(-2px); /* Reduced effect on mobile */
  }
}

/* Performance optimization: reduce animations on lower-end devices */
@media (prefers-reduced-motion: reduce) {
  .ken-burns-a,
  .ken-burns-b,
  .ken-burns-c,
  .ken-burns-d,
  .ken-burns-e,
  .ken-burns-f {
    animation: none !important;
  }
}

/* Loading states */
.skeleton {
  @apply animate-pulse bg-gray-800 rounded;
}

/* Focus visible for accessibility */
*:focus-visible {
  @apply outline-2 outline-offset-2 outline-primary-500;
}

/* Unified Color System - One Bold Cyan Theme */
:root {
  --primary: #0ea5e9; /* sky-500 */
  --primary-dark: #0284c7; /* sky-600 */
  --primary-light: #38bdf8; /* sky-400 */
  --accent: #a855f7; /* purple-500 */
  --accent-dark: #9333ea; /* purple-600 */
}

/* ===================================================================
   SOPHISTICATED SVG ICON ANIMATIONS
   ================================================================ */

/* Base icon styles - all SVG icons in components/icons/ */
svg[class*="w-"] {
  transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
  will-change: transform;
}

/* Icon Entrance Animation - fade in with subtle scale */
@keyframes iconEnter {
  from {
    opacity: 0;
    transform: scale(0.9) translateY(10px);
  }
  to {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

/* Icon Idle Animation - subtle pulse (optional, for key icons) */
@keyframes iconPulse {
  0%, 100% {
    opacity: 1;
    transform: scale(1);
  }
  50% {
    opacity: 0.8;
    transform: scale(1.02);
  }
}

/* Icon Hover Animation - scale with subtle glow */
svg[class*="w-"]:hover {
  transform: scale(1.1);
  filter: drop-shadow(0 4px 12px rgba(14, 165, 233, 0.4));
}

/* Icon entrance on scroll - applies to all icons */
.fade-in-on-scroll svg[class*="w-"] {
  animation: iconEnter 0.6s ease-out forwards;
}

/* Staggered icon entrance delays */
.fade-in-on-scroll:nth-child(1) svg { animation-delay: 0ms; }
.fade-in-on-scroll:nth-child(2) svg { animation-delay: 100ms; }
.fade-in-on-scroll:nth-child(3) svg { animation-delay: 200ms; }
.fade-in-on-scroll:nth-child(4) svg { animation-delay: 300ms; }
.fade-in-on-scroll:nth-child(5) svg { animation-delay: 400ms; }

/* Optional: Idle pulse for hero icons (apply class manually) */
.icon-pulse svg {
  animation: iconPulse 3s ease-in-out infinite;
}

/* Icon Groups - Different hover styles for different contexts */

/* Navigation/Header icons - subtle rotation */
nav svg[class*="w-"]:hover,
header svg[class*="w-"]:hover {
  transform: scale(1.08) rotate(5deg);
}

/* Music/Audio icons - bounce effect */
.music-icon:hover svg,
a[href*="spotify"] svg:hover,
a[href*="soundcloud"] svg:hover,
a[href*="bandcamp"] svg:hover {
  transform: scale(1.12) translateY(-4px);
  filter: drop-shadow(0 6px 16px rgba(14, 165, 233, 0.5));
}

/* Technical/Hardware icons - mechanical slide */
.technical-icon:hover svg {
  transform: scale(1.08) translateX(2px);
}

/* Research/Science icons - expand effect */
.research-icon:hover svg {
  transform: scale(1.15);
  filter: drop-shadow(0 8px 20px rgba(168, 85, 247, 0.4));
}

/* Respect reduced motion preferences */
@media (prefers-reduced-motion: reduce) {
  svg[class*="w-"] {
    transition: none !important;
    animation: none !important;
    will-change: auto;
  }

  svg[class*="w-"]:hover {
    transform: none !important;
    filter: none !important;
  }

  .icon-pulse svg {
    animation: none !important;
  }
}

/* Performance: Remove will-change after animation completes */
@media (hover: hover) and (pointer: fine) {
  svg[class*="w-"]:not(:hover) {
    will-change: auto;
  }
}

/* ===================================================================
   ADVANCED DEPTH & LAYERING SYSTEM
   ================================================================ */

/* Depth Level Utilities - Multi-layer shadows for realistic depth */

/* Shallow Depth - Subtle elevation (cards, buttons) */
.depth-shallow {
  box-shadow:
    0 1px 2px rgba(0, 0, 0, 0.05),
    0 2px 4px rgba(0, 0, 0, 0.05),
    0 4px 8px rgba(0, 0, 0, 0.05);
  transform: translateZ(0);
}

.depth-shallow:hover {
  box-shadow:
    0 2px 4px rgba(0, 0, 0, 0.08),
    0 4px 8px rgba(0, 0, 0, 0.08),
    0 8px 16px rgba(0, 0, 0, 0.08);
  transform: translateY(-2px) translateZ(0);
}

/* Medium Depth - Noticeable elevation (feature cards, modals) */
.depth-medium {
  box-shadow:
    0 2px 4px rgba(0, 0, 0, 0.08),
    0 4px 8px rgba(0, 0, 0, 0.08),
    0 8px 16px rgba(0, 0, 0, 0.08),
    0 16px 32px rgba(0, 0, 0, 0.08);
  transform: translateZ(0);
}

.depth-medium:hover {
  box-shadow:
    0 4px 8px rgba(0, 0, 0, 0.12),
    0 8px 16px rgba(0, 0, 0, 0.12),
    0 16px 32px rgba(0, 0, 0, 0.12),
    0 32px 64px rgba(0, 0, 0, 0.12);
  transform: translateY(-4px) translateZ(0);
}

/* Deep Depth - Dramatic elevation (hero sections, overlays) */
.depth-deep {
  box-shadow:
    0 4px 8px rgba(0, 0, 0, 0.12),
    0 8px 16px rgba(0, 0, 0, 0.12),
    0 16px 32px rgba(0, 0, 0, 0.12),
    0 32px 64px rgba(0, 0, 0, 0.12),
    0 64px 128px rgba(0, 0, 0, 0.12);
  transform: translateZ(0);
}

.depth-deep:hover {
  box-shadow:
    0 8px 16px rgba(0, 0, 0, 0.16),
    0 16px 32px rgba(0, 0, 0, 0.16),
    0 32px 64px rgba(0, 0, 0, 0.16),
    0 64px 128px rgba(0, 0, 0, 0.16),
    0 128px 256px rgba(0, 0, 0, 0.16);
  transform: translateY(-8px) translateZ(0);
}

/* Colored Depth Shadows - Using theme colors for impact */
.depth-primary {
  box-shadow:
    0 4px 12px rgba(14, 165, 233, 0.15),
    0 8px 24px rgba(14, 165, 233, 0.12),
    0 16px 48px rgba(14, 165, 233, 0.08);
}

.depth-primary:hover {
  box-shadow:
    0 8px 24px rgba(14, 165, 233, 0.25),
    0 16px 48px rgba(14, 165, 233, 0.20),
    0 32px 96px rgba(14, 165, 233, 0.15);
  transform: translateY(-6px);
}

.depth-accent {
  box-shadow:
    0 4px 12px rgba(168, 85, 247, 0.15),
    0 8px 24px rgba(168, 85, 247, 0.12),
    0 16px 48px rgba(168, 85, 247, 0.08);
}

.depth-accent:hover {
  box-shadow:
    0 8px 24px rgba(168, 85, 247, 0.25),
    0 16px 48px rgba(168, 85, 247, 0.20),
    0 32px 96px rgba(168, 85, 247, 0.15);
  transform: translateY(-6px);
}

/* 3D Perspective Containers */
.perspective-container {
  perspective: 1000px;
  perspective-origin: center center;
}

.perspective-far {
  perspective: 2000px;
}

.perspective-close {
  perspective: 500px;
}

/* 3D Transform Cards */
.card-3d {
  transform-style: preserve-3d;
  transition: transform 0.4s cubic-bezier(0.4, 0.0, 0.2, 1);
  will-change: transform;
}

.card-3d:hover {
  transform: rotateY(5deg) rotateX(-2deg) scale(1.02);
}

/* Floating Effect - Subtle vertical animation */
@keyframes float {
  0%, 100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-10px);
  }
}

.float {
  animation: float 6s ease-in-out infinite;
}

.float-slow {
  animation: float 8s ease-in-out infinite;
}

.float-fast {
  animation: float 4s ease-in-out infinite;
}

/* Enhanced Glass Morphism */
.glass-depth {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(12px) saturate(180%);
  -webkit-backdrop-filter: blur(12px) saturate(180%);
  border: 1px solid rgba(255, 255, 255, 0.12);
  box-shadow:
    0 4px 16px rgba(0, 0, 0, 0.1),
    inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

.glass-depth:hover {
  background: rgba(255, 255, 255, 0.12);
  backdrop-filter: blur(16px) saturate(200%);
  -webkit-backdrop-filter: blur(16px) saturate(200%);
  box-shadow:
    0 8px 32px rgba(0, 0, 0, 0.15),
    inset 0 1px 0 rgba(255, 255, 255, 0.15);
}

/* Layered Background Effect */
.layered-bg {
  position: relative;
  overflow: hidden;
}

.layered-bg::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(14, 165, 233, 0.1) 0%, rgba(168, 85, 247, 0.1) 100%);
  transform: translateZ(-1px);
  z-index: -1;
}

.layered-bg::after {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at top right, rgba(14, 165, 233, 0.05), transparent 50%);
  transform: translateZ(-2px);
  z-index: -2;
}

/* Inner Shadow for depth inversion */
.depth-inset {
  box-shadow:
    inset 0 2px 4px rgba(0, 0, 0, 0.1),
    inset 0 4px 8px rgba(0, 0, 0, 0.08);
}

/* Depth stacking context utilities */
.layer-1 { z-index: 10; transform: translateZ(10px); }
.layer-2 { z-index: 20; transform: translateZ(20px); }
.layer-3 { z-index: 30; transform: translateZ(30px); }
.layer-4 { z-index: 40; transform: translateZ(40px); }
.layer-5 { z-index: 50; transform: translateZ(50px); }

/* Neumorphism (soft depth) */
.neumorphic-light {
  background: linear-gradient(145deg, #f3f4f6, #ffffff);
  box-shadow:
    8px 8px 16px rgba(0, 0, 0, 0.1),
    -8px -8px 16px rgba(255, 255, 255, 0.8);
}

.neumorphic-dark {
  background: linear-gradient(145deg, #1a1a1a, #2a2a2a);
  box-shadow:
    8px 8px 16px rgba(0, 0, 0, 0.4),
    -8px -8px 16px rgba(255, 255, 255, 0.05);
}

/* Performance optimizations for depth effects */
.depth-shallow,
.depth-medium,
.depth-deep,
.depth-primary,
.depth-accent,
.card-3d {
  transition: box-shadow 0.3s cubic-bezier(0.4, 0.0, 0.2, 1),
              transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
  will-change: box-shadow, transform;
}

/* Remove will-change when not interacting */
@media (hover: hover) and (pointer: fine) {
  .depth-shallow:not(:hover),
  .depth-medium:not(:hover),
  .depth-deep:not(:hover),
  .depth-primary:not(:hover),
  .depth-accent:not(:hover),
  .card-3d:not(:hover) {
    will-change: auto;
  }
}

/* Reduced motion - disable 3D and floating */
@media (prefers-reduced-motion: reduce) {
  .card-3d:hover {
    transform: scale(1.02);
  }

  .float,
  .float-slow,
  .float-fast {
    animation: none;
  }

  .depth-shallow:hover,
  .depth-medium:hover,
  .depth-deep:hover {
    transform: translateZ(0);
  }
}

/* ===================================================================
   MODERN CSS FEATURES (2026)
   ================================================================ */

/* Container Queries - Responsive components based on parent size */
.container-responsive {
  container-type: inline-size;
  container-name: card;
}

@container card (min-width: 400px) {
  .card-title {
    font-size: 1.5rem;
  }

  .card-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
  }
}

@container card (min-width: 600px) {
  .card-title {
    font-size: 2rem;
  }

  .card-content {
    grid-template-columns: 1fr 1fr 1fr;
  }
}

/* :has() Selector - Parent state based on children */

/* Card with icon gets special styling */
.card:has(svg) {
  padding-top: 2rem;
}

/* Section with images gets different layout */
section:has(img) {
  & {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
  }
}

/* Form validation states */
.form-group:has(input:invalid) {
  & label {
    color: rgb(239, 68, 68);
  }

  & input {
    border-color: rgb(239, 68, 68);
  }
}

.form-group:has(input:valid) {
  & label {
    color: rgb(34, 197, 94);
  }

  & input {
    border-color: rgb(34, 197, 94);
  }
}

/* Navigation with active child */
nav:has(.active) {
  background: rgba(0, 0, 0, 0.05);
}

/* Grid that adjusts based on content */
.auto-grid:has(> :nth-child(4)) {
  grid-template-columns: repeat(2, 1fr);
}

.auto-grid:has(> :nth-child(7)) {
  grid-template-columns: repeat(3, 1fr);
}

/* CSS Nesting - Simplified selectors */
@layer components {
  .button {
    padding: 0.75rem 1.5rem;
    border-radius: 0.5rem;
    font-weight: 500;
    transition: all 0.2s;

    &:hover {
      transform: scale(1.05);
    }

    &:active {
      transform: scale(0.98);
    }

    &.primary {
      background: linear-gradient(to right, #0284c7, #9333ea);
      color: white;

      &:hover {
        background: linear-gradient(to right, #0ea5e9, #a855f7);
      }
    }

    &.secondary {
      border: 2px solid #0ea5e9;
      color: #38bdf8;

      &:hover {
        background: #0ea5e9;
        color: white;
      }
    }

    &[disabled] {
      opacity: 0.5;
      cursor: not-allowed;

      &:hover {
        transform: none;
      }
    }
  }

  .nav-item {
    position: relative;
    padding: 0.5rem 1rem;

    & a {
      color: inherit;
      text-decoration: none;

      &:hover {
        color: #0ea5e9;
      }
    }

    &.active {
      & a {
        color: #0ea5e9;
        font-weight: 600;
      }

      &::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: #0ea5e9;
      }
    }
  }

  .feature-card {
    padding: 2rem;
    border-radius: 1rem;
    background: white;
    transition: all 0.3s;

    & .icon {
      margin-bottom: 1rem;
      color: #0ea5e9;
    }

    & h3 {
      margin-bottom: 0.5rem;
      font-size: 1.5rem;
    }

    & p {
      color: #6b7280;
      line-height: 1.6;
    }

    &:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);

      & .icon {
        transform: scale(1.1);
        color: #a855f7;
      }
    }
  }
}

/* @layer for cascade control */
@layer overrides {
  /* High-priority overrides that beat utilities */
  .force-visible {
    display: block !important;
    opacity: 1 !important;
  }

  .force-hidden {
    display: none !important;
  }

  /* Debug utilities */
  .debug-outline * {
    outline: 1px solid red;
  }

  .debug-grid {
    background-image:
      linear-gradient(rgba(0, 0, 0, 0.05) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0, 0, 0, 0.05) 1px, transparent 1px);
    background-size: 20px 20px;
  }
}

/* Modern color functions (relative colors) */
@layer base {
  :root {
    /* Base colors */
    --color-primary: #0ea5e9;
    --color-accent: #a855f7;

    /* Derived colors using relative syntax */
    --color-primary-light: oklch(from var(--color-primary) calc(l + 0.2) c h);
    --color-primary-dark: oklch(from var(--color-primary) calc(l - 0.2) c h);

    --color-accent-light: oklch(from var(--color-accent) calc(l + 0.2) c h);
    --color-accent-dark: oklch(from var(--color-accent) calc(l - 0.2) c h);
  }
}

/* Container Query Units */
.responsive-text {
  /* Font size scales with container width */
  font-size: clamp(1rem, 5cqi, 3rem);
}

.responsive-spacing {
  /* Padding scales with container */
  padding: clamp(1rem, 5cqi, 3rem);
  gap: clamp(0.5rem, 3cqi, 2rem);
}

/* Advanced :has() - Complex logic */
.article:has(h2):has(img):has(blockquote) {
  /* Rich article with multiple content types */
  & {
    padding: 3rem;
    background: linear-gradient(135deg, #f0f9ff 0%, #faf5ff 100%);
  }
}

/* Quantity queries with :has() */
.gallery:has(> :nth-child(n + 10)) {
  /* Many items - use dense grid */
  grid-template-columns: repeat(4, 1fr);
  gap: 0.5rem;
}

.gallery:has(> :nth-child(-n + 3)) {
  /* Few items - use spacious grid */
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 2rem;
}

/* ===================================================================
   ASTRO 6.x VIEW TRANSITIONS
   ================================================================ */

/* Custom transition animations */
@layer base {
  /* Fade + slide transition for page content */
  ::view-transition-old(root) {
    animation: fade-out 0.3s cubic-bezier(0.4, 0, 1, 1);
  }

  ::view-transition-new(root) {
    animation: fade-in-slide 0.4s cubic-bezier(0, 0, 0.2, 1);
  }

  @keyframes fade-out {
    to {
      opacity: 0;
      transform: scale(0.98);
    }
  }

  @keyframes fade-in-slide {
    from {
      opacity: 0;
      transform: translateY(20px) scale(0.98);
    }
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  /* Smooth transition for images */
  ::view-transition-old(hero-image),
  ::view-transition-new(hero-image) {
    animation-duration: 0.5s;
    animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Card transitions - scale effect */
  ::view-transition-old(card) {
    animation: card-out 0.3s cubic-bezier(0.4, 0, 1, 1);
  }

  ::view-transition-new(card) {
    animation: card-in 0.4s cubic-bezier(0, 0, 0.2, 1);
  }

  @keyframes card-out {
    to {
      opacity: 0;
      transform: scale(0.95) translateY(-10px);
    }
  }

  @keyframes card-in {
    from {
      opacity: 0;
      transform: scale(0.95) translateY(10px);
    }
    to {
      opacity: 1;
      transform: scale(1) translateY(0);
    }
  }

  /* Navigation transitions - slide from side */
  ::view-transition-old(navbar) {
    animation: none;
  }

  ::view-transition-new(navbar) {
    animation: slide-from-top 0.3s cubic-bezier(0, 0, 0.2, 1);
  }

  @keyframes slide-from-top {
    from {
      transform: translateY(-100%);
    }
    to {
      transform: translateY(0);
    }
  }

  /* Respect reduced motion */
  @media (prefers-reduced-motion: reduce) {
    ::view-transition-old(root),
    ::view-transition-new(root),
    ::view-transition-old(hero-image),
    ::view-transition-new(hero-image),
    ::view-transition-old(card),
    ::view-transition-new(card),
    ::view-transition-old(navbar),
    ::view-transition-new(navbar) {
      animation: none !important;
    }
  }
}

/* ===================================================================
   PERFORMANCE POLISH
   ================================================================ */

/* CSS Containment for better rendering performance */
@layer base {
  /* Section containment - isolate layout/paint */
  section {
    contain: layout style;
  }

  /* Card containment - optimize repaints */
  .card,
  [class*="card-"] {
    contain: layout style paint;
  }

  /* Navigation containment */
  nav {
    contain: layout style;
  }

  /* Image containers */
  figure,
  picture {
    contain: layout;
  }
}

/* Content-visibility for off-screen elements */
.lazy-content {
  content-visibility: auto;
  contain-intrinsic-size: 0 500px;
}

/* Optimize font loading */
@layer base {
  /* Use font-display for faster text rendering */
  @font-face {
    font-display: swap;
  }

  /* Reduce layout shift with size-adjust */
  body {
    text-rendering: optimizeSpeed;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
}

/* GPU Acceleration for animations */
@layer components {
  .gpu-accelerated {
    transform: translateZ(0);
    will-change: transform;
    backface-visibility: hidden;
  }

  /* Remove will-change after animation */
  .gpu-accelerated:not(:hover):not(:focus):not(:active) {
    will-change: auto;
  }
}

/* Lazy loading images */
img[loading="lazy"] {
  content-visibility: auto;
  contain-intrinsic-size: 1px 1px;
}

/* Intersection Observer optimization classes */
.fade-in-lazy {
  opacity: 0;
  transform: translateY(20px);
  transition: opacity 0.6s ease-out, transform 0.6s ease-out;
}

.fade-in-lazy.visible {
  opacity: 1;
  transform: translateY(0);
}

/* Optimize scrolling performance */
@layer base {
  /* Smooth scrolling with contain */
  html {
    scroll-behavior: smooth;
    contain: layout style;
  }

  @media (prefers-reduced-motion: reduce) {
    html {
      scroll-behavior: auto;
    }
  }

  /* Optimize scroll containers */
  .scroll-container {
    overflow: auto;
    overscroll-behavior: contain;
    -webkit-overflow-scrolling: touch;
    scrollbar-gutter: stable;
  }
}

/* Performance monitoring hints */
@layer utilities {
  /* Force compositing layer */
  .layer-force {
    transform: translateZ(0);
    isolation: isolate;
  }

  /* Optimize paint areas */
  .paint-optimize {
    contain: paint;
  }

  /* Optimize layout */
  .layout-optimize {
    contain: layout;
  }

  /* Full containment */
  .contain-strict {
    contain: strict;
  }
}

/* Reduce repaints during animations */
@layer components {
  [class*="animate-"],
  [class*="transition-"],
  .animated {
    backface-visibility: hidden;
    perspective: 1000px;
  }
}

/* Optimize critical rendering path */
@layer base {
  /* Above-the-fold content */
  .above-fold {
    contain: layout style;
    content-visibility: visible;
  }

  /* Below-the-fold content */
  .below-fold {
    content-visibility: auto;
    contain-intrinsic-size: 0 1000px;
  }
}

/* Performance budget classes */
.perf-critical {
  /* Elements critical for FCP/LCP */
  content-visibility: visible;
  contain: none;
}

.perf-deferred {
  /* Elements that can be deferred */
  content-visibility: auto;
  contain: layout style paint;
  contain-intrinsic-size: 0 500px;
}

/* Optimize background images */
.bg-image-optimized {
  background-repeat: no-repeat;
  background-size: cover;
  background-position: center;
  will-change: transform;
}

.bg-image-optimized:not(:hover) {
  will-change: auto;
}

/* 60fps animation targets */
@layer utilities {
  .fps-60 {
    /* Only animate transform and opacity for 60fps */
    transition-property: transform, opacity;
    transform: translateZ(0);
  }
}
